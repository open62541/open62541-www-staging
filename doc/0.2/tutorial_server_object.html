

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Working with Objects and Object Types &mdash; open62541 0.2.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="open62541 0.2.0 documentation" href="index.html"/>
        <link rel="up" title="Tutorials" href="tutorials.html"/>
        <link rel="next" title="Adding Methods to Objects" href="tutorial_server_method.html"/>
        <link rel="prev" title="Working with Variable Types" href="tutorial_server_variabletype.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="toc.html" class="icon icon-home"> open62541
          

          
            
            <img src="_static/open62541_html.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                0.2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="building.html">Building open62541</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial_datatypes.html">Working with Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_firststeps.html">Building a Simple Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_variable.html">Adding Variables to a Server</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_datasource.html">Connecting a Variable with a Physical Process</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_variabletype.html">Working with Variable Types</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Working with Objects and Object Types</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#using-objects-to-structure-information-models">Using objects to structure information models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#object-types-type-hierarchies-and-instantiation">Object types, type hierarchies and instantiation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_server_method.html">Adding Methods to Objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_client_firststeps.html">Building a Simple Client</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="protocol.html">Protocol</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html">Data Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="information_modelling.html">Information Modelling</a></li>
<li class="toctree-l1"><a class="reference internal" href="services.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="server.html">Server</a></li>
<li class="toctree-l1"><a class="reference internal" href="client.html">Client</a></li>
<li class="toctree-l1"><a class="reference internal" href="constants.html">Standard-Defined Constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="namespace_compiler.html">XML Nodeset Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="internal.html">Internals</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="toc.html">open62541</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="toc.html">Docs</a> &raquo;</li>
        
          <li><a href="tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Working with Objects and Object Types</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial_server_object.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="working-with-objects-and-object-types">
<h1>Working with Objects and Object Types<a class="headerlink" href="#working-with-objects-and-object-types" title="Permalink to this headline">¶</a></h1>
<div class="section" id="using-objects-to-structure-information-models">
<h2>Using objects to structure information models<a class="headerlink" href="#using-objects-to-structure-information-models" title="Permalink to this headline">¶</a></h2>
<p>Assume a situation where we want to model a set of pumps and their runtime
state in an OPC UA information model. Of course, all pump representations
should follow the same basic structure, For example, we might have graphical
representation of pumps in a SCADA visualisation that shall be resuable for
all pumps.</p>
<p>Following the object-oriented programming paradigm, every pump is represented
by an object with the following layout:</p>
<img src="_images/graphviz-4957def2854b8c87a289891210c8f6eae96d00c0.png" alt="digraph tree {

fixedsize=true;
node [width=2, height=0, shape=box, fillcolor=&quot;#E5E5E5&quot;, concentrate=true]

node_root [label=&lt; &lt;I&gt;ObjectNode&lt;/I&gt;&lt;BR/&gt;Pump &gt;]

{ rank=same
  point_1 [shape=point]
  node_1 [label=&lt; &lt;I&gt;VariableNode&lt;/I&gt;&lt;BR/&gt;ManufacturerName &gt;] }
node_root -&gt; point_1 [arrowhead=none]
point_1 -&gt; node_1 [label=&quot;hasComponent&quot;]

{ rank=same
  point_2 [shape=point]
  node_2 [label=&lt; &lt;I&gt;VariableNode&lt;/I&gt;&lt;BR/&gt;ModelName &gt;] }
point_1 -&gt; point_2 [arrowhead=none]
point_2 -&gt; node_2 [label=&quot;hasComponent&quot;]

{  rank=same
   point_4 [shape=point]
   node_4 [label=&lt; &lt;I&gt;VariableNode&lt;/I&gt;&lt;BR/&gt;Status &gt;] }
point_2 -&gt; point_4 [arrowhead=none]
point_4 -&gt; node_4 [label=&quot;hasComponent&quot;]

{  rank=same
   point_5 [shape=point]
   node_5 [label=&lt; &lt;I&gt;VariableNode&lt;/I&gt;&lt;BR/&gt;MotorRPM &gt;] }
point_4 -&gt; point_5 [arrowhead=none]
point_5 -&gt; node_5 [label=&quot;hasComponent&quot;]

}" />
<p>The following code manually defines a pump and its member variables. We omit
setting constraints on the variable values as this is not the focus of this
tutorial and was already covered.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;signal.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;open62541.h&quot;</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">manuallyDefinePump</span><span class="p">(</span><span class="n">UA_Server</span> <span class="o">*</span><span class="n">server</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UA_NodeId</span> <span class="n">pumpId</span><span class="p">;</span> <span class="cm">/* get the nodeid assigned by the server */</span>
    <span class="n">UA_ObjectAttributes</span> <span class="n">oAttr</span><span class="p">;</span>
    <span class="n">UA_ObjectAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oAttr</span><span class="p">);</span>
    <span class="n">oAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;Pump (Manual)&quot;</span><span class="p">);</span>
    <span class="n">UA_Server_addObjectNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_NULL</span><span class="p">,</span>
                            <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_OBJECTSFOLDER</span><span class="p">),</span>
                            <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_ORGANIZES</span><span class="p">),</span>
                            <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Pump (Manual)&quot;</span><span class="p">),</span> <span class="n">UA_NODEID_NULL</span><span class="p">,</span>
                            <span class="n">oAttr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pumpId</span><span class="p">);</span>

    <span class="n">UA_VariableAttributes</span> <span class="n">mnAttr</span><span class="p">;</span>
    <span class="n">UA_VariableAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mnAttr</span><span class="p">);</span>
    <span class="n">UA_String</span> <span class="n">manufacturerName</span> <span class="o">=</span> <span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;Pump King Ltd.&quot;</span><span class="p">);</span>
    <span class="n">UA_Variant_setScalar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mnAttr</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">manufacturerName</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_STRING</span><span class="p">]);</span>
    <span class="n">mnAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;ManufacturerName&quot;</span><span class="p">);</span>
    <span class="n">UA_Server_addVariableNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">pumpId</span><span class="p">,</span>
                              <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASCOMPONENT</span><span class="p">),</span>
                              <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ManufacturerName&quot;</span><span class="p">),</span>
                              <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">mnAttr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="n">UA_VariableAttributes</span> <span class="n">modelAttr</span><span class="p">;</span>
    <span class="n">UA_VariableAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">modelAttr</span><span class="p">);</span>
    <span class="n">UA_String</span> <span class="n">modelName</span> <span class="o">=</span> <span class="n">UA_STRING</span><span class="p">(</span><span class="s">&quot;Mega Pump 3000&quot;</span><span class="p">);</span>
    <span class="n">UA_Variant_setScalar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">modelAttr</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">modelName</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_STRING</span><span class="p">]);</span>
    <span class="n">modelAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;ModelName&quot;</span><span class="p">);</span>
    <span class="n">UA_Server_addVariableNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">pumpId</span><span class="p">,</span>
                              <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASCOMPONENT</span><span class="p">),</span>
                              <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ModelName&quot;</span><span class="p">),</span>
                              <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">modelAttr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="n">UA_VariableAttributes</span> <span class="n">statusAttr</span><span class="p">;</span>
    <span class="n">UA_VariableAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">statusAttr</span><span class="p">);</span>
    <span class="n">UA_Boolean</span> <span class="n">status</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">UA_Variant_setScalar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">statusAttr</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_BOOLEAN</span><span class="p">]);</span>
    <span class="n">statusAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;Status&quot;</span><span class="p">);</span>
    <span class="n">UA_Server_addVariableNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">pumpId</span><span class="p">,</span>
                              <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASCOMPONENT</span><span class="p">),</span>
                              <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Status&quot;</span><span class="p">),</span>
                              <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">statusAttr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="n">UA_VariableAttributes</span> <span class="n">rpmAttr</span><span class="p">;</span>
    <span class="n">UA_VariableAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rpmAttr</span><span class="p">);</span>
    <span class="n">UA_Double</span> <span class="n">rpm</span> <span class="o">=</span> <span class="mf">50.0</span><span class="p">;</span>
    <span class="n">UA_Variant_setScalar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rpmAttr</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rpm</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_DOUBLE</span><span class="p">]);</span>
    <span class="n">rpmAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;MotorRPM&quot;</span><span class="p">);</span>
    <span class="n">UA_Server_addVariableNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">pumpId</span><span class="p">,</span>
                              <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASCOMPONENT</span><span class="p">),</span>
                              <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;MotorRPMs&quot;</span><span class="p">),</span>
                              <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">rpmAttr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="object-types-type-hierarchies-and-instantiation">
<h2>Object types, type hierarchies and instantiation<a class="headerlink" href="#object-types-type-hierarchies-and-instantiation" title="Permalink to this headline">¶</a></h2>
<p>Building up each object manually requires us to write a lot of code.
Furthermore, there is no way for clients to detect that an object represents
a pump. (We might use naming conventions or similar to detect pumps. But
that’s not exactly a clean solution.) Furthermore, we might have more devices
than just pumps. And we require all devices to share some common structure.
The solution is to define ObjectTypes in a hierarchy with inheritance
relations.</p>
<img src="_images/graphviz-5eaf25a30c42d86e57969c260aef0821cb66270b.png" alt="digraph tree {

fixedsize=true;
node [width=2, height=0, shape=box, fillcolor=&quot;#E5E5E5&quot;, concentrate=true]

node_root [label=&lt; &lt;I&gt;ObjectTypeNode&lt;/I&gt;&lt;BR/&gt;Device &gt;]

{ rank=same
  point_1 [shape=point]
  node_1 [label=&lt; &lt;I&gt;VariableNode&lt;/I&gt;&lt;BR/&gt;ManufacturerName&lt;BR/&gt;(mandatory) &gt;] }
node_root -&gt; point_1 [arrowhead=none]
point_1 -&gt; node_1 [label=&quot;hasComponent&quot;]

{ rank=same
  point_2 [shape=point]
  node_2 [label=&lt; &lt;I&gt;VariableNode&lt;/I&gt;&lt;BR/&gt;ModelName &gt;] }
point_1 -&gt; point_2 [arrowhead=none]
point_2 -&gt; node_2 [label=&quot;hasComponent&quot;]

{  rank=same
   point_3 [shape=point]
   node_3 [label=&lt; &lt;I&gt;ObjectTypeNode&lt;/I&gt;&lt;BR/&gt;Pump &gt;] }
point_2 -&gt; point_3 [arrowhead=none]
point_3 -&gt; node_3 [label=&quot;hasSubtype&quot;]

{  rank=same
   point_4 [shape=point]
   node_4 [label=&lt; &lt;I&gt;VariableNode&lt;/I&gt;&lt;BR/&gt;Status&lt;BR/&gt;(mandatory) &gt;] }
node_3 -&gt; point_4 [arrowhead=none]
point_4 -&gt; node_4 [label=&quot;hasComponent&quot;]

{  rank=same
   point_5 [shape=point]
   node_5 [label=&lt; &lt;I&gt;VariableNode&lt;/I&gt;&lt;BR/&gt;MotorRPM &gt;] }
point_4 -&gt; point_5 [arrowhead=none]
point_5 -&gt; node_5 [label=&quot;hasComponent&quot;]

}" />
<p>Children that are marked mandatory are automatically instantiated together
with the parent object. This is indicated by a <cite>hasModellingRule</cite> reference
to an object that representes the <cite>mandatory</cite> modelling rule.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="cm">/* predefined identifier for later use */</span>
<span class="n">UA_NodeId</span> <span class="n">pumpTypeId</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="n">UA_NODEIDTYPE_NUMERIC</span><span class="p">,</span> <span class="p">{</span><span class="mi">1001</span><span class="p">}};</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">defineObjectTypes</span><span class="p">(</span><span class="n">UA_Server</span> <span class="o">*</span><span class="n">server</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* Define the object type for &quot;Device&quot; */</span>
    <span class="n">UA_NodeId</span> <span class="n">deviceTypeId</span><span class="p">;</span> <span class="cm">/* get the nodeid assigned by the server */</span>
    <span class="n">UA_ObjectTypeAttributes</span> <span class="n">dtAttr</span><span class="p">;</span>
    <span class="n">UA_ObjectTypeAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dtAttr</span><span class="p">);</span>
    <span class="n">dtAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;DeviceType&quot;</span><span class="p">);</span>
    <span class="n">UA_Server_addObjectTypeNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_NULL</span><span class="p">,</span>
                                <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_BASEOBJECTTYPE</span><span class="p">),</span>
                                <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASSUBTYPE</span><span class="p">),</span>
                                <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;DeviceType&quot;</span><span class="p">),</span> <span class="n">dtAttr</span><span class="p">,</span>
                                <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">deviceTypeId</span><span class="p">);</span>

    <span class="n">UA_VariableAttributes</span> <span class="n">mnAttr</span><span class="p">;</span>
    <span class="n">UA_VariableAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">mnAttr</span><span class="p">);</span>
    <span class="n">mnAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;ManufacturerName&quot;</span><span class="p">);</span>
    <span class="n">UA_NodeId</span> <span class="n">manufacturerNameId</span><span class="p">;</span>
    <span class="n">UA_Server_addVariableNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">deviceTypeId</span><span class="p">,</span>
                              <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASCOMPONENT</span><span class="p">),</span>
                              <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ManufacturerName&quot;</span><span class="p">),</span>
                              <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">mnAttr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">manufacturerNameId</span><span class="p">);</span>
    <span class="cm">/* Make the manufacturer name mandatory */</span>
    <span class="n">UA_Server_addReference</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">manufacturerNameId</span><span class="p">,</span>
                           <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASMODELLINGRULE</span><span class="p">),</span>
                           <span class="n">UA_EXPANDEDNODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_MODELLINGRULE_MANDATORY</span><span class="p">),</span> <span class="nb">true</span><span class="p">);</span>


    <span class="n">UA_VariableAttributes</span> <span class="n">modelAttr</span><span class="p">;</span>
    <span class="n">UA_VariableAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">modelAttr</span><span class="p">);</span>
    <span class="n">modelAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;ModelName&quot;</span><span class="p">);</span>
    <span class="n">UA_Server_addVariableNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">deviceTypeId</span><span class="p">,</span>
                              <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASCOMPONENT</span><span class="p">),</span>
                              <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;ModelName&quot;</span><span class="p">),</span>
                              <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">modelAttr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="cm">/* Define the object type for &quot;Pump&quot; */</span>
    <span class="n">UA_ObjectTypeAttributes</span> <span class="n">ptAttr</span><span class="p">;</span>
    <span class="n">UA_ObjectTypeAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ptAttr</span><span class="p">);</span>
    <span class="n">ptAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;PumpType&quot;</span><span class="p">);</span>
    <span class="n">UA_Server_addObjectTypeNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pumpTypeId</span><span class="p">,</span>
                                <span class="n">deviceTypeId</span><span class="p">,</span> <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASSUBTYPE</span><span class="p">),</span>
                                <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;PumpType&quot;</span><span class="p">),</span> <span class="n">ptAttr</span><span class="p">,</span>
                                <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="n">UA_VariableAttributes</span> <span class="n">statusAttr</span><span class="p">;</span>
    <span class="n">UA_VariableAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">statusAttr</span><span class="p">);</span>
    <span class="n">statusAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;Status&quot;</span><span class="p">);</span>
    <span class="n">statusAttr</span><span class="p">.</span><span class="n">valueRank</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">UA_NodeId</span> <span class="n">statusId</span><span class="p">;</span>
    <span class="n">UA_Server_addVariableNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">pumpTypeId</span><span class="p">,</span>
                              <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASCOMPONENT</span><span class="p">),</span>
                              <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Status&quot;</span><span class="p">),</span>
                              <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">statusAttr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">statusId</span><span class="p">);</span>
    <span class="cm">/* Make the status variable mandatory */</span>
    <span class="n">UA_Server_addReference</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">statusId</span><span class="p">,</span>
                           <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASMODELLINGRULE</span><span class="p">),</span>
                           <span class="n">UA_EXPANDEDNODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_MODELLINGRULE_MANDATORY</span><span class="p">),</span> <span class="nb">true</span><span class="p">);</span>

    <span class="n">UA_VariableAttributes</span> <span class="n">rpmAttr</span><span class="p">;</span>
    <span class="n">UA_VariableAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rpmAttr</span><span class="p">);</span>
    <span class="n">rpmAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="s">&quot;MotorRPM&quot;</span><span class="p">);</span>
    <span class="n">rpmAttr</span><span class="p">.</span><span class="n">valueRank</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="n">UA_Server_addVariableNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">pumpTypeId</span><span class="p">,</span>
                              <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASCOMPONENT</span><span class="p">),</span>
                              <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;MotorRPMs&quot;</span><span class="p">),</span>
                              <span class="n">UA_NODEID_NULL</span><span class="p">,</span> <span class="n">rpmAttr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now we add the derived ObjectType for the pump that inherits from the device
object type. The resulting object contains all mandatory child variables.
These are simply copied over from the object type. The object has a reference
of type <code class="docutils literal"><span class="pre">hasTypeDefinition</span></code> to the object type, so that clients can detect
the type-instance relation at runtime.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="k">static</span> <span class="kt">void</span>
<span class="nf">addPumpObjectInstance</span><span class="p">(</span><span class="n">UA_Server</span> <span class="o">*</span><span class="n">server</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UA_ObjectAttributes</span> <span class="n">oAttr</span><span class="p">;</span>
    <span class="n">UA_ObjectAttributes_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">oAttr</span><span class="p">);</span>
    <span class="n">oAttr</span><span class="p">.</span><span class="n">displayName</span> <span class="o">=</span> <span class="n">UA_LOCALIZEDTEXT</span><span class="p">(</span><span class="s">&quot;en_US&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
    <span class="n">UA_Server_addObjectNode</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">UA_NODEID_NULL</span><span class="p">,</span>
                            <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_OBJECTSFOLDER</span><span class="p">),</span>
                            <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_ORGANIZES</span><span class="p">),</span>
                            <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
                            <span class="n">pumpTypeId</span><span class="p">,</span> <span class="cm">/* this refers to the object type</span>
<span class="cm">                                           identifier */</span>
                            <span class="n">oAttr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Often times, we want to run a constructor function on a new object. This is
especially useful when an object is instantiated at runtime (with the
AddNodes service) and the integration with an underlying process canot be
manually defined. In the following constructor example, we simply set the
pump status to on.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">UA_Server</span> <span class="o">*</span><span class="n">s</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="cm">/* required to get the server pointer into the constructor</span>
<span class="cm">                        function (will change for v0.3) */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="o">*</span>
<span class="nf">pumpTypeConstructor</span><span class="p">(</span><span class="k">const</span> <span class="n">UA_NodeId</span> <span class="n">instance</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span> <span class="n">UA_LOGCATEGORY_USERLAND</span><span class="p">,</span> <span class="s">&quot;New pump created&quot;</span><span class="p">);</span>

    <span class="cm">/* Find the NodeId of the status child variable */</span>
    <span class="n">UA_RelativePathElement</span> <span class="n">rpe</span><span class="p">;</span>
    <span class="n">UA_RelativePathElement_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rpe</span><span class="p">);</span>
    <span class="n">rpe</span><span class="p">.</span><span class="n">referenceTypeId</span> <span class="o">=</span> <span class="n">UA_NODEID_NUMERIC</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">UA_NS0ID_HASCOMPONENT</span><span class="p">);</span>
    <span class="n">rpe</span><span class="p">.</span><span class="n">isInverse</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">rpe</span><span class="p">.</span><span class="n">includeSubtypes</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="n">rpe</span><span class="p">.</span><span class="n">targetName</span> <span class="o">=</span> <span class="n">UA_QUALIFIEDNAME</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Status&quot;</span><span class="p">);</span>

    <span class="n">UA_BrowsePath</span> <span class="n">bp</span><span class="p">;</span>
    <span class="n">UA_BrowsePath_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bp</span><span class="p">);</span>
    <span class="n">bp</span><span class="p">.</span><span class="n">startingNode</span> <span class="o">=</span> <span class="n">instance</span><span class="p">;</span>
    <span class="n">bp</span><span class="p">.</span><span class="n">relativePath</span><span class="p">.</span><span class="n">elementsSize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">bp</span><span class="p">.</span><span class="n">relativePath</span><span class="p">.</span><span class="n">elements</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">rpe</span><span class="p">;</span>

    <span class="n">UA_BrowsePathResult</span> <span class="n">bpr</span> <span class="o">=</span>
        <span class="n">UA_Server_translateBrowsePathToNodeIds</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bp</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="n">bpr</span><span class="p">.</span><span class="n">statusCode</span> <span class="o">!=</span> <span class="n">UA_STATUSCODE_GOOD</span> <span class="o">||</span>
       <span class="n">bpr</span><span class="p">.</span><span class="n">targetsSize</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

    <span class="cm">/* Set the status value */</span>
    <span class="n">UA_Boolean</span> <span class="n">status</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="n">UA_Variant</span> <span class="n">value</span><span class="p">;</span>
    <span class="n">UA_Variant_setScalar</span><span class="p">(</span><span class="o">&amp;</span><span class="n">value</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">status</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">UA_TYPES</span><span class="p">[</span><span class="n">UA_TYPES_BOOLEAN</span><span class="p">]);</span>
    <span class="n">UA_Server_writeValue</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">bpr</span><span class="p">.</span><span class="n">targets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">targetId</span><span class="p">.</span><span class="n">nodeId</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
    <span class="n">UA_BrowsePathResult_deleteMembers</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bpr</span><span class="p">);</span>

    <span class="cm">/* The return pointer of the constructor is attached to the ObjectNode */</span>
    <span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">addPumpTypeConstructor</span><span class="p">(</span><span class="n">UA_Server</span> <span class="o">*</span><span class="n">server</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UA_ObjectLifecycleManagement</span> <span class="n">olm</span><span class="p">;</span>
    <span class="n">olm</span><span class="p">.</span><span class="n">constructor</span> <span class="o">=</span> <span class="n">pumpTypeConstructor</span><span class="p">;</span>
    <span class="n">olm</span><span class="p">.</span><span class="n">destructor</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">UA_Server_setObjectTypeNode_lifecycleManagement</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="n">pumpTypeId</span><span class="p">,</span> <span class="n">olm</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It follows the main server code, making use of the above definitions.</p>
<div class="highlight-c"><div class="highlight"><pre><span></span><span class="n">UA_Boolean</span> <span class="n">running</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">stopHandler</span><span class="p">(</span><span class="kt">int</span> <span class="n">sign</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">UA_LOG_INFO</span><span class="p">(</span><span class="n">UA_Log_Stdout</span><span class="p">,</span> <span class="n">UA_LOGCATEGORY_SERVER</span><span class="p">,</span> <span class="s">&quot;received ctrl-c&quot;</span><span class="p">);</span>
    <span class="n">running</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">signal</span><span class="p">(</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">stopHandler</span><span class="p">);</span>
    <span class="n">signal</span><span class="p">(</span><span class="n">SIGTERM</span><span class="p">,</span> <span class="n">stopHandler</span><span class="p">);</span>

    <span class="n">UA_ServerConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="n">UA_ServerConfig_standard</span><span class="p">;</span>
    <span class="n">UA_ServerNetworkLayer</span> <span class="n">nl</span> <span class="o">=</span>
        <span class="n">UA_ServerNetworkLayerTCP</span><span class="p">(</span><span class="n">UA_ConnectionConfig_standard</span><span class="p">,</span> <span class="mi">16664</span><span class="p">);</span>
    <span class="n">config</span><span class="p">.</span><span class="n">networkLayers</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">nl</span><span class="p">;</span>
    <span class="n">config</span><span class="p">.</span><span class="n">networkLayersSize</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">UA_Server</span> <span class="o">*</span><span class="n">server</span> <span class="o">=</span> <span class="n">UA_Server_new</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">server</span><span class="p">;</span> <span class="cm">/* required for the constructor */</span>

    <span class="n">manuallyDefinePump</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
    <span class="n">defineObjectTypes</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
    <span class="n">addPumpObjectInstance</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="s">&quot;pump2&quot;</span><span class="p">);</span>
    <span class="n">addPumpObjectInstance</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="s">&quot;pump3&quot;</span><span class="p">);</span>
    <span class="n">addPumpTypeConstructor</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
    <span class="n">addPumpObjectInstance</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="s">&quot;pump4&quot;</span><span class="p">);</span>
    <span class="n">addPumpObjectInstance</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="s">&quot;pump5&quot;</span><span class="p">);</span>

    <span class="n">UA_Server_run</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">running</span><span class="p">);</span>
    <span class="n">UA_Server_delete</span><span class="p">(</span><span class="n">server</span><span class="p">);</span>
    <span class="n">nl</span><span class="p">.</span><span class="n">deleteMembers</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nl</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorial_server_method.html" class="btn btn-neutral float-right" title="Adding Methods to Objects" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="tutorial_server_variabletype.html" class="btn btn-neutral" title="Working with Variable Types" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, The open62541 authors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>